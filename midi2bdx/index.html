<!DOCTYPE html><head><link href=/favicon.ico rel="shortcut icon" type=image/x-icon><title>MIDI转BDX | By Dislink</title><script src=/javascript/MIDIFile.js type=text/javascript></script><script src=/javascript/brotli-js.js type=text/javascript></script><script src=/javascript/FileSaver.js type=text/javascript></script><script>function formatSeconds(o){return`${Math.floor(o/3600)<10?"0"+Math.floor(o/3600):Math.floor(o/3600)}:${Math.floor(o/60%60)<10?"0"+Math.floor(o/60%60):Math.floor(o/60%60)}:`+(Math.round(o%60)<10?"0"+Math.round(o%60):Math.round(o%60))}</script><script>function pointerMove(r,o,n){let t="";return 1==r?t+="":-1==r&&(t+=""),1==o?t+="":-1==o&&(t+=""),1==n?t+="":-1==n&&(t+=""),t}function placeCommandBlockWithCommandBlockData(r,o,n,t,a,e){return String.fromCharCode(36,(65280&r)>>>8,255&r,(4278190080&o)>>>24,(16711680&o)>>>16,(65280&o)>>>8,255&o)+n+"\0"+t+"\0\0"+String.fromCharCode((4278190080&a)>>>24,(16711680&a)>>>16,(65280&a)>>>8,255&a)+"\0\0"+String.fromCharCode(e)}BDXFileHdr=[66,68,64],BDXDataP1=[66,68,88,0,68,105,115,108,105,110,107,95,83,102,111,114,122,97,0],BDXDataEnd=[88,69]</script><script>function getSoundString(e,n=!1){return n?[55].includes(e)?"note.cow_bell":[41,43,45].includes(e)?"note.hat":[36,37,39].includes(e)?"note.snare":"note.bd":[105].includes(e)?"note.banjo":[32,33,34,35,36,37,38,39].includes(e)?"note.bass":[115,116,117,118].includes(e)?"note.basedrum":[9].includes(e)?"note.bell":[80,81].includes(e)?"note.bit":[112].includes(e)?"note.cow_bell":[72,73,74,75,76,77,78,79,41,42,43,44].includes(e)?"note.flute":[24,25,26,27,28,29,30,31].includes(e)?"note.guitar":[14].includes(e)?"note.chime":[8,9,10,11,12,13,15].includes(e)?"note.iron_xylophone":[2].includes(e)?"note.pling":"note.harp"}</script><script>melodicSounds=["Acoustic Grand Piano-大钢琴 1","Bright Acoustic Piano-大钢琴 2","Electric Grand Piano-电子大钢琴","Honky","Electric Piano 1(Rhodes Piano)-电钢琴 1(练习音钢琴)","Electric Piano 2(Chorused Piano)-电钢琴 2(合唱加钢琴)","Harpsichord-拨弦古钢琴(羽管键琴)","Clavi-古钢琴","Celesta-钢片琴","Glockenspiel-钟琴","Music box-八音盒","Vibraphone-电颤琴","Marimba-马林巴琴","Xylophone-木琴","Tubular Bells-管钟","Dulcimer-扬琴","Drawbar Organ(Hammond Organ)-音栓风琴(击杆风琴)","Percussive Organ-敲击风琴(打击型风琴)","Rock Organ-摇滚管风琴","Church Organ-教堂管风琴","Reed Organ-簧风琴","Accordion-手风琴","Harmonica-口琴","Tango Accordion-探戈手风琴","Acoustic Guitar(nylon)-尼龙弦吉他","Acoustic Guitar(steel)-钢弦吉他","Electric Guitar(jazz)-电吉他(爵士)","Electric Guitar(clean)-电吉他(清音)","Electric Guitar(muted)-电吉他(弱音)","Overdriven Guitar-驱动效果吉他","Distortion Guitar-失真效果吉他","Guitar harmonics-吉他泛音","Acoustic Bass-原声贝斯","Electric Bass(finger)-电贝斯(指奏)","Electric Bass(pick)-电贝斯(拨奏)","Fretless Bass-无品贝斯","Slap Bass 1-击弦贝斯 1","Slap Bass 2-击弦贝斯 2","Synth Bass 1-合成贝斯 1","Synth Bass 2-合成贝斯 2","Violin-小提琴","Viola-中提琴","Cello-大提琴","Contrabass-低音提琴","Tremolo Strings-颤弓弦乐(弦乐震音)","Pizzicato Strings-弹拨弦乐(弦乐拨奏)","Orchestral Harp-竖琴","Timpani-定音鼓","String Ensemble 1-弦乐合奏 1","String Ensemble 2-弦乐合奏 2","Synth Strings 1-合成弦乐 1","Synth Strings 2-合成弦乐 2","Choir Aahs-合唱“啊”音","Voice Oohs-人声“嘟”音","Synth Voice-合成人声","Orchestra Hit-交响打击乐","Trumpet-小号","Trombone-长号","Tuba-大号","Muted Trumpet-弱音小号","French Horn-圆号(法国号)","Brass Section-铜管乐(铜管组)","Synth Brass 1-合成铜管 1","Synth Brass 2-合成铜管 2","Soprano Sax-高音萨克斯风","Alto Sax-中音萨克斯风","Tenor Sax-次中音萨克斯风","Baritone Sax-上低音萨克斯风","Oboe-双簧管","English Horn-英国管","Bassoon-大管(巴松管)","Clarinet-单簧管(黑管)","Piccolo-短笛","Flute-长笛","Recorder-竖笛(直笛)","Pan Flute-排笛","Blown Bottle-吹瓶口(瓶笛)","Shakuhachi-尺八","Whistle-哨子","Ocarina-陶笛","Lead 1(square)-方波","Lead 2(sawtooth)-锯齿波","Lead 3(calliope)-汽笛风琴","Lead 4(chiff)-合成吹管","Lead 5(charang)-合成电吉他","Lead 6(voice)-人声键盘","Lead 7(fifths)-五度音","Lead 8(bass + lead)-低音+主音","Pad 1(new age)-新世纪","Pad 2(warm)-暖音","Pad 3(polysynth)-复合成","Pad 4(choir)-人声合唱","Pad 5(bowed)-弓弦","Pad 6(metallic)-金属","Pad 7(halo)-光晕","Pad 8(sweep)-扫弦","FX 1(rain)-雨","FX 2(soundtrack)-音轨","FX 3(crystal)-水晶","FX 4(atmosphere)-大气","FX 5(light)-轻柔","FX 6(goblins)-魅影","FX 7(echoes)-回音","FX 8(sci-fi)-科幻","Sitar-西塔琴","Banjo-五弦琴(班卓琴)","Shamisen-三味线","Koto-日本筝","Kalimba-卡林巴铁片琴","Bagpipe-苏格兰风笛","Fiddle-古提琴","Shanai-唢呐","Tinkle Bell-铃铛","Agogo-拉丁打铃","Steel Drums-钢鼓","Woodblock-木块","Taiko Drum-太鼓","Melodic Tom-古式高音鼓","Synth Drum-合成鼓","Reverse Cymbal-铜钹","Guitar Fret Noise-吉他品格杂音","Breath Noise-呼吸杂音","Seashore-海浪","Bird Tweet-鸟鸣","Telephone-电话","Helicopter-直升机","Applause-鼓掌","Gunshot-枪声"],percussionNotes=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Acoustic Bass Drum-大鼓 2","Bass Drum 1-大鼓 1","Side Stick-小鼓鼓边","Acoustic Snare-小鼓 1","Hand Clap-拍手","Electric Snare-小鼓 2","Low Floor Tom-低音鼓 2","Closed Hi-Hat-闭合钹","High Floor Tom-低音鼓 1","Pedal Hi-Hat-脚踏钹","Low Tom-中音鼓 2","Open Hi-Hat-强音钹","Low-Mid Tom-中音鼓 1","Hi Mid Tom 2-高音鼓 2","Crash Cymbal 1-强音钹 1","High Tom-高音鼓 1","Ride Cymbal 1-打点钹 1","Chinese Cymbal-钹","Ride Bell-圆铃","Tambourine-铃鼓","Splash Cymbal-小钹铜钹","Cowbell-牛铃","Crash Cymbal 2-强音钹 2","Vibra-Slap-颤音器","Ride Cymbal 2-打点钹 2","Hi Bongo-高音邦加鼓","Low Bongo-低音邦加鼓","Mute Hi Conga-弱音高音康加鼓","Open Hi Conga-强音高音康加鼓","Low Conga-低音康加鼓","High Timbale-高音天巴鼓","Low Timbale-低音天巴鼓","High Agogo-高音阿哥哥","Low Agogo-低音阿哥哥","Cabasa-串珠","Maracas-沙铃","Short Whistle-短口哨","Long Whistle-长口哨","Short Guiro-短刮壶","Long Guiro-长刮壶","Claves-梆子","Hi Wood Block-高音木块","Low Wood Block-低音木块","Mute Cuica-弱音吉加鼓","Open Cuica-强音吉加鼓","Mute Triangle-弱音三角铁","Open Triangle-强音三角铁"]</script><style>input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none}input[type=number]{-moz-appearance:textfield;width:3rem}body{background-color:#fff}</style></head><body><form id=arguments><input id=upload type=file accept=audio/midi> <label for=upload>上传midi文件</label><br><fieldset id=mid_info style=display:none><legend>MIDI信息</legend><h3 id=timeTotal></h3><h3 id=tracksCount><h3><h3 id=noteOnCount><h3><h3 id=instrumentsCount><h3><h4 style=float:right;color:grey>TIP:不妨试试音·创库版：本地的多功能音乐转换器</h4></h3></h3></h3></h3></h3></h3></fieldset><fieldset id=convert_args><legend>转换参数</legend><input id=speedScroll type=range value=100 step=0.1 max=400 min=1> <label for=speedScroll>速度百分比</label> <input id=speed type=number value=100 step=0.1> <label for=speed>%</label><br><input id=volume4MainScroll type=range value=0.9 step=0.01 max=1 min=0> <label for=volume4MainScroll>主音轨音量衰减系数</label> <input id=volume4Main type=number value=0.9 step=0.01><br><input id=volume4SubScroll type=range value=0.7 step=0.01 max=1 min=0> <label for=volume4SubScroll>副音轨音量衰减系数</label> <input id=volume4Sub type=number value=0.7 step=0.01> <label for=convertTracks style=display:none>转换音轨</label> <select id=convertTracks multiple=true style=display:none></select><br><label for=defaultSound>默认音色</label> <input id=defaultSound type=text value=note.harp><br><label for=pitchOffset>音调偏移</label> <input id=pitchOffset type=number value=0><br><input id=ignorePercussionInstrument type=checkbox> <label for=ignorePercussionInstrument>忽略打击乐器</label><br><input id=convertToDefault type=checkbox> <label for=convertToDefault>全部使用默认音色</label><br><table border=1 id=convertSounds></table></fieldset><fieldset id=command_args><legend>bdx、命令参数</legend><input id=xLengthScroll type=range value=8 max=256 min=1> <label for=xLengthScroll>x轴延伸长度</label> <input id=xLength type=number value=8 step=1> <label for=xLength>block(s)</label><br><input id=zLengthScroll type=range value=8 max=256 min=1> <label for=zLengthScroll>z轴延伸长度</label> <input id=zLength type=number value=8 step=1> <label for=zLength>block(s)</label><br><label for=text>玩家选择器</label> <input id=playerSelector type=text value=@a><br><label for=commandVersion>命令版本</label> <select id=commandVersion><option value=formal selected=selected>旧execute语法规范</option><option value=new>新execute语法规范</option><option value=no-execute>不使用execute(不推荐，会影响效果)</option></select></fieldset><br></form><br><button id=download style=display:none>下载文件</button><br><div id=status></div><script>speedScroll.onchange=e=>{speed.value=e.target.value},speed.onchange=e=>{speedScroll.value=e.target.value},xLengthScroll.onchange=e=>{xLength.value=e.target.value},xLength.onchange=e=>{xLengthScroll.value=e.target.value},zLengthScroll.onchange=e=>{zLength.value=e.target.value},zLength.onchange=e=>{zLengthScroll.value=e.target.value},volume4MainScroll.onchange=e=>{volume4Main.value=e.target.value},volume4Main.onchange=e=>{volume4MainScroll.value=e.target.value},volume4SubScroll.onchange=e=>{volume4Sub.value=e.target.value},volume4Sub.onchange=e=>{volume4SubScroll.value=e.target.value},upload.onchange=()=>{var y;upload.files[0]&&((y=new FileReader).onload=()=>{try{for(var e in(midiFile=new MIDIFile(y.result)).getEvents())midiFile.timeTotal=midiFile.timeTotal>midiFile.getEvents()[e].slice(-1)[0].playTime?midiFile.timeTotal:midiFile.getEvents()[e].slice(-1)[0].playTime;document.getElementById("timeTotal").innerText="时长："+formatSeconds(Math.round(midiFile.timeTotal/1e3)),document.getElementById("tracksCount").innerText="音轨数："+midiFile.header.getTracksCount(),document.getElementById("noteOnCount").innerText="音符数："+midiFile.getEvents([MIDIEvents.EVENT_MIDI],[MIDIEvents.EVENT_MIDI_NOTE_ON],[],!0)[0].filter(e=>e.param2).length,document.getElementById("convertSounds").innerHTML="<td>数据(以出现时间顺序排列)</td><td>音效值</td><td>音量乘数</td><td>音调偏移</td>",soundStrings=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];let t=midiFile.getEvents([MIDIEvents.EVENT_MIDI],[MIDIEvents.EVENT_MIDI_PROGRAM_CHANGE,MIDIEvents.EVENT_MIDI_NOTE_ON],[],!0)[0].sort((e,n)=>e.playTime>n.playTime);for(let n in t){var a,l,r,o,u,s,d,i,c,p,m,g,v,h,I,E;9!=t[n].channel&&t[n].subtype==MIDIEvents.EVENT_MIDI_PROGRAM_CHANGE?(a=document.createElement("tr"),l=document.createElement("td"),r=document.createElement("td"),o=document.createElement("td"),u=document.createElement("td"),s=document.createElement("input"),(d=document.createElement("input")).type="number",(i=document.createElement("input")).type="number",l.innerText=formatSeconds(t[n].playTime/1e3)+"C#"+t[n].channel+":"+melodicSounds[t[n].param1],soundStrings[t[n].channel].push([getSoundString(t[n].param1),1,0]),s.value=soundStrings[t[n].channel][soundStrings[t[n].channel].length-1][0],s.seq=soundStrings[t[n].channel].length-1,s.onchange=e=>{soundStrings[t[n].channel][e.target.seq][0]=e.target.value},d.value=soundStrings[t[n].channel][soundStrings[t[n].channel].length-1][1],d.seq=soundStrings[t[n].channel].length-1,d.onchange=e=>{soundStrings[t[n].channel][e.target.seq][1]=parseFloat(e.target.value)},i.value=soundStrings[t[n].channel][soundStrings[t[n].channel].length-1][2],i.seq=soundStrings[t[n].channel].length-1,i.onchange=e=>{soundStrings[t[n].channel][e.target.seq][2]=parseFloat(e.target.value)},r.appendChild(s),o.appendChild(d),u.appendChild(i),a.appendChild(l),a.appendChild(r),a.appendChild(o),a.appendChild(u),document.getElementById("convertSounds").appendChild(a)):t[n].subtype!=MIDIEvents.EVENT_MIDI_NOTE_ON||9!=t[n].channel||soundStrings[t[n].param1]||(c=document.createElement("tr"),p=document.createElement("td"),m=document.createElement("td"),g=document.createElement("td"),v=document.createElement("td"),h=document.createElement("input"),(I=document.createElement("input")).type="number",(E=document.createElement("input")).type="number",p.innerText=formatSeconds(t[n].playTime/1e3)+"P#"+t[n].param1+":"+percussionNotes[t[n].param1],soundStrings[t[n].param1]=[getSoundString(t[n].param1,!0),1,1],h.value=soundStrings[t[n].param1][0],h.onchange=e=>{soundStrings[t[n].param1][0]=e.target.value},I.value=soundStrings[t[n].param1][1],I.onchange=e=>{soundStrings[t[n].param1][1]=parseFloat(e.target.value)},E.value=soundStrings[t[n].param1][2],E.onchange=e=>{soundStrings[t[n].param1][2]=parseFloat(e.target.value)},m.appendChild(h),g.appendChild(I),v.appendChild(E),c.appendChild(p),c.appendChild(m),c.appendChild(g),c.appendChild(v),document.getElementById("convertSounds").appendChild(c))}document.getElementById("instrumentsCount").innerText="转换乐器数："+(Array.from(new Set(soundStrings)).length+1),document.getElementById("convertTracks").innerHTML="";var n,S=midiFile.getEvents([MIDIEvents.EVENT_META],[MIDIEvents.EVENT_META_TRACK_NAME],[],!1);for(n in midiFile.tracks){var T=document.createElement("option");T.value=n,T.selected=!0,T.innerText=`#${n} `+(S[n].length?new TextDecoder("utf-8").decode(Uint8Array.from(S[n][0].data)):""),document.getElementById("convertTracks").appendChild(T)}document.getElementById("convertTracks").labels[0].style="display: block",document.getElementById("convertTracks").style="display: block",document.getElementById("mid_info").style="display: block;",document.getElementById("download").style="display: block;",fileName=upload.files[0].name}catch(e){document.getElementById("status").innerText=e.toString().split("\n")[0],alert(e.toString().split("\n")[0]+",可能是midi文件损坏")}},y.readAsArrayBuffer(upload.files[0]))},download.onclick=()=>{var e,n=[],t=[];for(e in convertTracks.children)convertTracks.children[e].selected&&(n.push(parseInt(e)),t[parseInt(e)]=-1);var a=midiFile.getEvents([MIDIEvents.EVENT_MIDI],[MIDIEvents.EVENT_MIDI_PROGRAM_CHANGE,MIDIEvents.EVENT_MIDI_NOTE_ON],n,!0)[0].sort((e,n)=>e.playTime>n.playTime);let l=0,r="",o=0,u=0,s=0,d=!1,i=!1;for(;u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l<a.length;){for(o=0;o<parseInt(xLength.value)&&u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l<a.length;o++){for(s=0;s<parseInt(zLength.value)&&u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l<a.length;s++){var c,p=a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l];a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l].subtype==MIDIEvents.EVENT_MIDI_PROGRAM_CHANGE?(t[a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l].channel]++,s--,l++):!a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l].param2||ignorePercussionInstrument.checked&&9==a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l].channel?(s--,l++):(c=soundStrings[p.channel][t[p.channel]],r=(r+=placeCommandBlockWithCommandBlockData(s==parseInt(zLength.value)-1?o==parseInt(xLength.value)-1?1:d?4:5:i?2:3,0==o&&0==u&&0==s?0:2,`${"no-execute"==commandVersion.value?"":"formal"==commandVersion.value?"execute "+playerSelector.value+" ~~~ ":"execute as "+playerSelector.value+" run "}playsound ${convertToDefault.checked?defaultSound.value:9==p.channel?soundStrings[p.param1][0]:(c||[])[0]||defaultSound.value} @${"no-execute"==commandVersion.value?"a":"s"} ~~4~ ${p.param2*(0==p.channel?parseFloat(volume4Main.value):parseFloat(volume4Sub.value))*0.01*(9==p.channel?soundStrings[p.param1][1]:((c||[])[1]!=undefined?(c||[])[1]:1))} `+(9==p.channel?soundStrings[p.param1][2]:2**((p.param1+((c||[])[2]||0)+parseFloat(pitchOffset.value)-66)/12)),"",u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l?Math.round((p.playTime-a[u*parseInt(xLength.value)*parseInt(zLength.value)+o*parseInt(zLength.value)+s+l-1].playTime)/(parseFloat(speed.value)/100*50)):Math.round(p.playTime/(parseFloat(speed.value)/100*50)),0==o&&0==u&&0==s))+(s==parseInt(zLength.value)-1?"":pointerMove(0,0,0==i?1:-1)))}r+=o==parseInt(xLength.value)-1?pointerMove(0,1,0):pointerMove(0==d?1:-1,0,0),i=!i,s=0}d=!d,o=0,u++}var m,g=new Array(r.length);for(m in r)g[m]=r.charCodeAt(m);compressed=(new Brotli).compressArray(Uint8Array.from(BDXDataP1.concat(g.concat(BDXDataEnd))),6),saveAs(new Blob([Uint8Array.from(BDXFileHdr.concat(Array.from(compressed)))]),fileName+".bdx")}</script></body>
