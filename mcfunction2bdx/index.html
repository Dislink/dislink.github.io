<!DOCTYPE html>
<head>
	<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
	<title>mcfunction转BDX | By Dislink</title>
	<script src="javascript/brotli-js.js" type="text/javascript"></script>
	<script src="javascript/FileSaver.js" type="text/javascript"></script>
	<script>function pointerMove(r,o,n){let t="";return 1==r?t+="":-1==r&&(t+=""),1==o?t+="":-1==o&&(t+=""),1==n?t+="":-1==n&&(t+=""),t}function placeCommandBlockWithCommandBlockData(r,o,n,t,a,e){return String.fromCharCode(36,(65280&r)>>>8,255&r,(4278190080&o)>>>24,(16711680&o)>>>16,(65280&o)>>>8,255&o)+n+"\0"+t+"\0\0"+String.fromCharCode((4278190080&a)>>>24,(16711680&a)>>>16,(65280&a)>>>8,255&a)+"\0\0"+String.fromCharCode(e)}BDXFileHdr=[66,68,64],BDXDataP1=[66,68,88,0,68,105,115,108,105,110,107,95,83,102,111,114,122,97,0],BDXDataEnd=[88,69]</script>
</head>
<body>
	<form id="arguments">
		<input id="upload" type="file" accept=".mcfunction">
		 <label for="upload">上传mcfunction文件</label>
		<br>
		<fieldset id="fileInfo" style="display:none">
		<legend>文件信息</legend>
			<h3 id="fileName"></h3>
			<h3 id="linesTotal"><h3>
			<h3 id="commandsTotal"><h3>
		</h3></h3></h3></h3></fieldset>
		<fieldset id="command_args">
		<legend>bdx、命令参数</legend>
			<input id="xLengthScroll" type="range" value="8" max="256" min="1">
			<label for="xLengthScroll">x轴延伸长度</label>
			<input id="xLength" type="number" value="8" step="1">
			<label for="xLength">block(s)</label>
			<br>
			<input id="zLengthScroll" type="range" value="8" max="256" min="1">
			<label for="zLengthScroll">z轴延伸长度</label>
			<input id="zLength" type="number" value="8" step="1">
			<label for="zLength">block(s)</label>
		</fieldset>
		<br>
	</form>
	<br>
	<button id="download" style="display:none">下载文件</button>
	<br>
	<div id="status"></div>
	<script>xLengthScroll.onchange=e=>{xLength.value=e.target.value},xLength.onchange=e=>{xLengthScroll.value=e.target.value},zLengthScroll.onchange=e=>{zLength.value=e.target.value},zLength.onchange=e=>{zLengthScroll.value=e.target.value},upload.onchange=()=>{var n;upload.files[0]&&((n=new FileReader).onload=()=>{document.getElementById("fileInfo").style="display: block;",document.getElementById("download").style="display: block;",document.getElementById("fileName").innerText="文件名："+upload.files[0].name;var e=new TextDecoder;contentRaw=e.decode(n.result),contents=contentRaw.split("\n"),commands=contents.filter(e=>e.match(/^[^#]*/)[0]),document.getElementById("linesTotal").innerText=`文件大小：${contentRaw.lenth}字符`,document.getElementById("linesTotal").innerText="文件行数："+contents.length,document.getElementById("commandsTotal").innerText="命令数："+commands.length},n.readAsArrayBuffer(upload.files[0]))},download.onclick=()=>{let e="",n=0,t=0,a=0,l=0,o=!1,r=!1;for(;a*parseInt(xLength.value)*parseInt(zLength.value)+t*parseInt(zLength.value)+l+n<commands.length;){for(t=0;t<parseInt(xLength.value)&&a*parseInt(xLength.value)*parseInt(zLength.value)+t*parseInt(zLength.value)+l+n<commands.length;t++){for(l=0;l<parseInt(zLength.value)&&a*parseInt(xLength.value)*parseInt(zLength.value)+t*parseInt(zLength.value)+l+n<commands.length;l++){var c=commands[a*parseInt(xLength.value)*parseInt(zLength.value)+t*parseInt(zLength.value)+l];c.match(/^[^#]*/)[0]?e=(e+=placeCommandBlockWithCommandBlockData(l==parseInt(zLength.value)-1?t==parseInt(xLength.value)-1?1:o?4:5:r?2:3,0==t&&0==a&&0==l?0:2,c.match(/^[^#]*/)[0],"",0,0==t&&0==a&&0==l))+(l==parseInt(zLength.value)-1?"":pointerMove(0,0,0==r?1:-1)):(l--,n++)}e+=t==parseInt(xLength.value)-1?pointerMove(0,1,0):pointerMove(0==o?1:-1,0,0),r=!r,l=0}o=!o,t=0,a++}var s,g=new Array(e.length);for(s in e)g[s]=e.charCodeAt(s);compressed=(new Brotli).compressArray(Uint8Array.from(BDXDataP1.concat(g.concat(BDXDataEnd))),6),saveAs(new Blob([Uint8Array.from(BDXFileHdr.concat(Array.from(compressed)))]),fileName.innerText.slice(4).replace(/\.mcfunction$/,"")+".bdx")}</script>
</body>
